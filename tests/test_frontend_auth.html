<!DOCTYPE html>
<html>
<head>
    <title>Test Frontend Auth</title>
</head>
<body>
    <h1>Test Frontend Authentication</h1>
    <button onclick="testDemoLogin()">Test Demo Login</button>
    <button onclick="testCreateNeed()">Test Create Need</button>
    <div id="result"></div>

    <script>
        let authToken = null;

        async function testDemoLogin() {
            try {
                const response = await fetch('http://localhost:8000/demo/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'username=demo.school@edu.tw&password=demo_school_2024',
                });

                if (!response.ok) {
                    throw new Error(`Login failed: ${response.status}`);
                }

                const data = await response.json();
                authToken = data.access_token;
                document.getElementById('result').innerHTML = `
                    <h3>Login Success!</h3>
                    <p>Token: ${authToken.substring(0, 50)}...</p>
                    <p>User: ${JSON.stringify(data.user || 'No user data')}</p>
                `;
            } catch (error) {
                document.getElementById('result').innerHTML = `<p style="color: red;">Login Error: ${error.message}</p>`;
            }
        }

        async function testCreateNeed() {
            if (!authToken) {
                document.getElementById('result').innerHTML = '<p style="color: red;">Please login first!</p>';
                return;
            }

            try {
                const needData = {
                    title: "測試需求",
                    description: "測試描述",
                    category: "測試類別",
                    location: "測試地點",
                    student_count: 10,
                    urgency: "medium",
                    sdgs: [4]
                };

                const response = await fetch('http://localhost:8000/school_needs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`,
                    },
                    body: JSON.stringify(needData),
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Create need failed: ${response.status} - ${errorText}`);
                }

                const result = await response.json();
                document.getElementById('result').innerHTML = `
                    <h3>Create Need Success!</h3>
                    <p>Created Need ID: ${result.id}</p>
                    <p>Title: ${result.title}</p>
                `;
            } catch (error) {
                document.getElementById('result').innerHTML = `<p style="color: red;">Create Need Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
